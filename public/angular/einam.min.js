(function(){angular.module("einamApp",["ngRoute","ngSanitize","ui.bootstrap"]);function e(e,t){e.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/common/views/genericText.view.html",controller:"genericTextCtrl",controllerAs:"vm"}).when("/location/:locationid",{templateUrl:"/locationDetail/locationDetail.view.html",controller:"locationDetailCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode(true)}angular.module("einamApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("einamApp").controller("homeCtrl",e);e.$inject=["$scope","einamData","geolocation"];function e(e,t,n){var o=this;o.pageHeader={title:"Einam",strapline:"Rask geriausias restauracijas ir barus!"};o.sidebar={content:"Ieškai geros vietos su wifi ir maistu išsinešimui?"};o.message="Checking your location...";o.getData=function(e){o.message="Searching for nearby locations";var n=e.coords.longitude,r=e.coords.latitude;t.locationByCoords(r,n).success(function(e){o.message=e.length>0?"":"No locations nearby found.";o.data={locations:e}}).error(function(e){o.message="Something went wrong"})};o.showError=function(t){e.$apply(function(){o.message="There was an error."})};o.noGeo=function(){e.$apply(function(){o.message="Your browser does not support geolocation."})};n.getPosition(o.getData,o.showError,o.noGeo)}})();(function(){angular.module("einamApp").controller("locationDetailCtrl",e);e.$inject=["$routeParams","$location","einamData","$uibModal","authentication"];function e(e,t,n,o,r){var i=this;i.locationid=e.locationid;i.isLoggedIn=r.isLoggedIn();i.currentPath=t.path();n.locationById(i.locationid).success(function(e){i.data={location:e};i.pageHeader={title:i.data.location.name}}).error(function(e){console.log(e)});i.popupReviewForm=function(){var e=o.open({templateUrl:"/reviewModal/reviewModal.view.html",controller:"reviewModalCtrl as vm",resolve:{locationData:function(){return{locationid:i.locationid,locationName:i.data.location.name}}}});e.result.then(function(e){i.data.location.reviews.push(e)})}}})();(function(){angular.module("einamApp").service("geolocation",e);function e(){var e=function(e,t,n){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,t)}else{n()}};return{getPosition:e}}})();(function(){angular.module("einamApp").service("einamData",e);e.$inject=["$http","authentication"];function e(e,t){var n=function(t,n){return e.get("/api/locations?lng="+n+"&lat="+t+"&maxDistance=10000")};var o=function(t){return e.get("/api/locations/"+t)};var r=function(n,o){return e.post("/api/locations/"+n+"/reviews",o,{headers:{Authorization:"Bearer "+t.getToken()}})};return{locationByCoords:n,locationById:o,addReviewById:r}}})();(function(){angular.module("einamApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,t){var n=function(e){t.localStorage["einam-token"]=e};var o=function(){return t.localStorage["einam-token"]};var r=function(){var e=o();if(e){var n=JSON.parse(t.atob(e.split(".")[1]));return n.exp>Date.now()/1e3}else{return false}};var i=function(){if(r()){var e=o();var n=JSON.parse(t.atob(e.split(".")[1]));return{email:n.email,name:n.name}}};var a=function(t){return e.post("/api/register",t).success(function(e){n(e.token)})};var l=function(t){return e.post("/api/login",t).success(function(e){n(e.token)})};var c=function(){t.localStorage.removeItem("einam-token")};return{currentUser:i,saveToken:n,getToken:o,isLoggedIn:r,register:a,login:l,logout:c}}})();(function(){angular.module("einamApp").filter("formatDistance",t);var e=function(e){return!isNaN(e)&&isFinite(e)};function t(){return function(t){var n,o;if(t&&e(t)||t===0){if(t>1e3){n=parseFloat(parseInt(t)/1e3).toFixed(1);o="km"}else{n=parseInt(t);o="m"}return n+o}else{return"?"}}}})();(function(){angular.module("einamApp").directive("ratingStars",e);function e(){return{restrict:"EA",scope:{thisRating:"=rating"},templateUrl:"/common/directives/ratingStars/ratingStars.template.html"}}})();(function(){angular.module("einamApp").directive("footerGeneric",e);function e(){return{restrict:"EA",scope:{author:"@author",year:"=year"},templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("einamApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("einamApp").controller("navigationCtrl",e);e.$inject=["$location","$route","authentication"];function e(e,t,n){var o=this;o.currentPath=e.path();o.isLoggedIn=n.isLoggedIn();o.currentUser=n.currentUser();o.logout=function(){n.logout();if(e.path()==="/"){t.reload()}else{e.path("/")}}}})();(function(){angular.module("einamApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();(function(){angular.module("einamApp").controller("genericTextCtrl",e);function e(){var e=this;e.pageHeader={title:"Apie Einam."};e.main={content:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce facilisis ornare\nest, eu finibus enim ultricies eget. Proin accumsan et eros in maximus. Ut et risus convallis,\nvulputate elit at, porta enim. Phasellus dictum tortor eu tellus tincidunt sollicitudin. Aliquam\nleo dolor, laoreet vel semper at, dictum sed dolor. Maecenas iaculis tortor quis augue imperdiet,\neget suscipit sapien ullamcorper. Pellentesque aliquam, risus quis sagittis sollicitudin, erat odio\nrutrum nunc, sed tristique velit felis euismod sem. Sed a metus id massa porttitor dignissim. Nunc\nfermentum mollis rutrum. Mauris cursus sit amet enim ut rhoncus.\nClass aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos."}}})();(function(){angular.module("einamApp").filter("addHtmlLineBreaks",e);function e(){return function(e){var t=e.replace(/\n/g,"<br/>");return t}}})();(function(){angular.module("einamApp").controller("reviewModalCtrl",e);e.$inject=["$uibModalInstance","einamData","locationData"];function e(e,t,n){var o=this;o.locationData=n;o.onSubmit=function(){o.formError="";if(!o.formData.rating||!o.formData.reviewText){o.formError="All fields are required, please try again.";return false}else{o.doAddReview(o.locationData.locationid,o.formData)}};o.doAddReview=function(e,n){t.addReviewById(e,{rating:n.rating,reviewText:n.reviewText}).success(function(e){o.modal.close(e)}).error(function(e){console.log(e);o.formError="Your review has not been saved, try again."});return false};o.modal={cancel:function(){e.dismiss("cancel")},close:function(t){e.close(t)}}}})();(function(){angular.module("einamApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var n=this;n.pageHeader={title:"Užsiregistruokite Einam puslapyje"};n.credentials={name:"",email:"",password:""};n.returnPage=e.search().page||"/";n.onSubmit=function(){n.formError="";if(!n.credentials.name||!n.credentials.email||!n.credentials.password){n.formError="Prašom užpildyt visus laukus ir bandyti dar kartą.";return false}else{n.doRegister()}};n.doRegister=function(){n.formError="";t.register(n.credentials).error(function(e){n.formError=e}).then(function(){e.search("page",null);e.path(n.returnPage)})}}})();(function(){angular.module("einamApp").controller("loginCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var n=this;n.pageHeader={title:"Prisijunk prie Einam"};n.credentials={email:"",password:""};n.returnPage=e.search().page||"/";n.onSubmit=function(){n.formError="";if(!n.credentials.email||!n.credentials.password){n.formError="Prašom užpildyt visus laukus ir bandyti dar kartą";return false}else{n.doLogin()}};n.doLogin=function(){n.formError="";t.login(n.credentials).error(function(e){n.formError=e}).then(function(){e.search("page",null);e.path(n.returnPage)})}}})();